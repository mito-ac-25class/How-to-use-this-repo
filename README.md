# 課題リポジトリの使い方

本授業では、**Github codespaces** というオンライン環境で課題リポジトリを開くことで演習を実施します。  
本 README に codespaces を使った演習の実施方法や制限がまとまっています。

## やってみよう

チュートリアルとして、以下のステージを順番にこなしてみましょう。  

### **ステージ1**

1. `src/kadai/hello.py` に、以下のような関数を定義してみましょう。  
   
   - `Hello, World!` という文字列を返す関数 `hello_world()` 

2. `tests/stages/stage-01/test_hello_world.py` で、1. のコードが正しく出来ているかテスト出来ます。
   
   ターミナルを開き、以下のコマンドを実行してプログラムをテストしましょう。

   ```bash
   ./scripts/test 1
   ```

3. 全てのテストを実行して、**ステージ1** のテスト**だけ**に成功している状態であることを確認しましょう。

   全てのテストは、以下のコマンドで実行できます。

   ```bash
   pytest
   ```

4. ソース管理 > コミット下の変更にカーソルを合わせ、全ての変更をステージします。  
   その後、コミットメッセージに `hello_world関数を実装` のように書いてコミットしてみましょう。

   > [!WARNING]
   > 変更を同期 はリポジトリを提出してしまうので、最後まで実施してはいけません。

### **ステージ2**

1. `tests/stages/stage-02/test_hello_person.py` に、**ステージ2** で実施するテストが記述されています。
   
   テストを確認して、次に実装する必要があるコードのイメージを掴みましょう。

2. テスト通り、`src/kadai/hello.py` に、以下のような関数を定義してみましょう。   
   
   - `Hello, World!` という文字列を返す関数 `hello_person()`

   関数の動作は、今のところ **ステージ1** の `hello_world()` と同じように動けばよいでしょう。

3. **ステージ2**のテストを実施して、プログラムが正しく実装出来ているか確認してみましょう。

   ```bash
   ./scripts/test 2
   ```

4. テストに通らなかったのではないでしょうか？  
   関数を追加するときは、`src/kadai/__init__.py` に追加した関数を教えてあげなければいけません。(今後の授業で扱います)  
   修正したら、また **ステージ2**のテストに通るか確かめてみましょう。

   ```python
   from .hello import hello_world, hello_person # 1つ追加
   ```

5. 全てのテストを実行して、**ステージ1~2** のテスト**だけ**に成功している状態であることを確認しましょう。

   ```bash
   pytest
   ```

6. **ステージ1~2** のテスト**だけ**に成功していることを確認したら、**ステージ1** と同じ手順でコミットします。  
   コミットメッセージは `hello_person関数を実装` のように書けばよいでしょう。
   
   > [!WARNING]
   > 変更を同期 はリポジトリを提出してしまうので、最後まで実施してはいけません。

### **ステージ3**

1. `tests/stages/stage-03/test_returns_name.py` に、**ステージ3** で実施するテストが記述されています。
   
   テストを確認して、次に実装する必要があるコードのイメージを掴みましょう。

2. テスト通り、`src/kadai/hello.py` の `hello_person()` 関数を、以下のように変更してみましょう。

   - 文字列を引数にとり、`Hello, (引数)!` という文字列を返す関数 `hello_person()`

3. **ステージ3**のテストを実施して、プログラムが正しく実装出来ているか確認してみましょう。

   ```bash
   ./scripts/test 3
   ```

4. 全てのテストを実行して、全てのテストに成功している状態であることを確認しましょう。  
   **ステージ1** や **ステージ2** のテストに失敗している場合、時には一度変更前の状態に戻してから再度 **ステージ3** に挑戦すべきでしょう。

   ```bash
   pytest
   ```

   課題リポジトリでは、Git を使ってリポジトリを**コミット前の状態に戻す**ことが出来ます。  
   どこを変更したか分からなくなってしまったら、以下の手順で 1 つコミットを遡って再挑戦してください。

   1. ソース管理 > **コミットの上の「変更」** にカーソルを合わせる
   2. 「変更」の右の「・・・」から、「前回のコミットを元に戻す」
   3. 「変更」の右の「・・・」から、変更 > すべての変更のステージング解除
   4. 「変更」の右の「・・・」から、変更 > すべての変更の破棄
---

## 主な課題演習の流れ

1. 招待リンクから課題を受け取る
2. codespaces で開く
3. README.md で課題を確認する
4. src/kadai 配下にある課題ファイル (.py) で課題用プログラムを記述する
5. ターミナルに `pytest` または `./scripts/test N` を打ち込み、課題用プログラムをテストする
6. 一段階テストに通ったら、コミットして、次の段階のテストにも通るよう課題プログラムを修正する
7. 全てのテストに通ったら、サイドバー > ソース管理から課題を提出する

> [!NOTE]
> プログラムを書く ⇔ テストを実行を繰り返し、最後に提出することを覚えておきましょう。

### 課題提出手順

1. サイドバー > ソース管理 > コミットの下の「**変更**」にカーソルを合わせる
2. ＋マークの「**すべての変更をステージ**」
3. **コミットメッセージに変更内容を簡単に記述**して、**コミット**
4. **変更を同期**

> [!WARNING]
> コミットメッセージが空欄のままコミットするとエラーが発生します。

## 機能

### オートセーブ

codespaces では、皆さんが記述したプログラムは自動で保存されます。

### 手動/自動テスト

皆さんが記述したテストは、`pytest` ライブラリで手動/自動でテストされます。  
自動テストは課題の提出時に行われ、テスト結果によって自動採点されます。

- 単一のステージのテストを手動実行したい
  ```bash
  ./scripts/test (ステージ番号)
  ./scripts/test 1
  ```

- 全てのステージのテストをまとめて手動実行したい
  ```bash
  pytest
  ```

## ディレクトリ構成

課題リポジトリは、基本的に以下ツリーのような構成となっています。

```
(課題リポジトリ名)
├── .gitignore
├── pyproject.toml
├── pytest.ini 〇
├── README.md ★
├── requirements-dev.txt
├── requirements.txt
├── .devcontainer
│   └── devcontainer.json
├── .github
│   └── workflows
│       └── classroom.yml
├── scripts
│   └── test ★
├── src
│   └── kadai
│       └── (演習用Pythonファイル) ★
└── tests
    └── stages
        └── stage-XX
            └── (ステージXXのテストファイル) ★
```

> [!CAUTION]
> ★ や 〇 の付いたファイルは課題において重要なファイルです。  
> その他のファイルは自動採点や環境設定に関わる、これまた重要なファイルです。編集厳禁！

## ★: 特に重要なファイル

### README.md

課題の内容が記述されているファイルです。  
Markdown という形式で書かれているため .md という拡張子が付いています。  
課題を実施する際は、まず README.md をよく確認してください。

### scripts/test

プログラムのテストを支援するシェルスクリプトです。  
ターミナルで以下コマンドを実行することで、プログラムのテストを一部のみ実施することが出来ます。  

```bash
./scripts/test (ステージ番号)
```

```bash
./scripts/test 1
```

codespaces 環境構築時にデフォルトで導入されている `pytest` というライブラリによって、
以下コマンドで全てのテストを実施することが出来ます。

```bash
pytest
```

### src/kadai/(演習用Pythonファイル)

皆さんが Python 言語でプログラムを記述するファイルです。  
Python では、.py 拡張子のファイルに Python プログラムを記述します。(これまでは .ipynb という拡張子のノートブックファイルを使用していました)  
基となる課題ファイルを修正したり、空のディレクトリに課題ファイルを追加したりと、実施内容は課題によって様々です。  

### tests/stages/stage-XX/(ステージXXのテストファイル)

課題は複数のステージに分かれたテストによって正しく実装されているか判断されます。  
皆さんの目標は、ステージ1 から順にテストを通る状態を維持しながら、段階的にプログラムを構築し、全てのテストを通すことです。  
`./scripts/test XX` は、 ステージ `XX` のテストのみを実行します。  
`pytest` は、全てのステージのテストを実行します。

## 〇: 課題によって重要になるファイル

### pytest.ini

`pytest` の設定ファイルです。  
皆さんが `tests/stages` 配下にテストコードを追加する必要がある際、`pytest.ini` にマーカーを追加する必要があります。

## 用語

### ディレクトリ

フォルダのことです。

### Git/Github

Git は、ファイルのバージョン管理を行うツールです。  
Git で管理されたリポジトリをインターネット上で共有・公開するためのサービスが Github です。  
本リポジトリでは、課題の共有目的で Github と Git の一部機能を利用しています。

### リポジトリ

ソースコードやデータ等を置いておく場所のこと。本課題リポジトリは、課題に関するファイルを置いてある場所です。  
現在編集できるリポジトリは、Github からコピーして codespaces 環境で開いているローカルリポジトリです。  
変更をステージ > コミット > 変更を同期 することで、Github のリモートリポジトリに変更を同期し、課題提出扱いとなります。

### 変更をステージ

ファイルを Git というバージョン管理システムの管理下に置くことです。  
変更をステージすると、変更されたファイルを Git が認識し、後のコミット+変更を同期で変更履歴を Github に送信することで提出が完了します。

### コミット

ローカルリポジトリの変更履歴をセーブすることです。

### 変更を同期

プッシュ (`push`) とも呼びます。  
ローカルリポジトリの変更内容をリモートリポジトリに同期します。